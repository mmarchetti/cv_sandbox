 #!/usr/bin/python

import atexit
import cv2
from datetime import datetime
import numpy as np
import os
import sys

from camera import Camera
from window import ImageWindow

if len(sys.argv) > 1:
    camera_index = int(sys.argv[1])
else:
    camera_index = 0

camera = Camera(camera_index, (800, 448, 20))
window = ImageWindow()
atexit.register(cv2.destroyAllWindows)

# our calibration pattern is 9x7 (counting inner corners only)
print "Press spacebar to accept an image, q to quit."

image_num = 1
folder = os.path.join('saved', datetime.now().isoformat().replace(':', '.'))
os.makedirs(folder)

for frame in camera.frames():
    window.add_image(frame)
    window.show()
    window.clear()

    key = window.get_key(100)

    if key == 'q':
        break
    elif key == ' ':
        # accept this image
        filename = os.path.join(folder, 'image%02d.png' % image_num)
        cv2.imwrite(filename, frame)
        image_num += 1
        print(filename)
